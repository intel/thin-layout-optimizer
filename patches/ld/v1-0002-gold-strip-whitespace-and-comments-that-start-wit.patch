From 8c99e24945d34b2d41af0286cd6cb04385543120 Mon Sep 17 00:00:00 2001
From: Noah Goldstein <goldstein.w.n@gmail.com>
Date: Mon, 22 Apr 2024 16:21:10 -0500
Subject: gold: strip whitespace (and comments that start with whitespace) from
 ordering file

---
 gold/layout.cc | 27 +++++++++++++++++++++++----
 1 file changed, 23 insertions(+), 4 deletions(-)

diff --git a/gold/layout.cc b/gold/layout.cc
index b94855f8662..b752e4bb64a 100644
--- a/gold/layout.cc
+++ b/gold/layout.cc
@@ -2940,12 +2940,31 @@ Layout::read_layout_from_file()
     {
       if (!line.empty() && line[line.length() - 1] == '\r')   // Windows
 	line.resize(line.length() - 1);
-      // Ignore comments, beginning with '#'
-      if (line[0] == '#')
+      // Ignore comments
+      size_t comment_pos = line.find('#');
+      if (comment_pos != std::string::npos)
 	{
-	  std::getline(in, line);
-	  continue;
+	   line = line.substr (0, comment_pos);
+	}
+      // Trim whitespace
+      size_t leading_ws = line.find_first_not_of (" \t");
+      if (leading_ws == std::string::npos)
+	{
+	   line.clear ();
+	}
+      else
+	{
+	   size_t trailing_ws = line.find_last_not_of (" \t");
+	   size_t trimmed_size = trailing_ws - leading_ws + 1;
+	   line = line.substr (leading_ws, trimmed_size);
 	}
+
+      if (line.empty())
+	{
+	   std::getline (in, line);
+	   continue;
+	}
+
       this->input_section_position_[line] = position;
       // Store all glob patterns in a vector.
       if (is_wildcard_string(line.c_str()))
-- 
2.34.1

